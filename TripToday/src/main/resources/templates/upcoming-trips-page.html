<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming trips | TripToday</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/main.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/upcoming-trips-page.css}">
    <script src="http://localhost:35729/livereload.js"></script>
    <style>
        input[readonly] {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        .enroll-button:disabled {
            background-color: #cccccc;
            border-color: #cccccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div class="container-fluid mt-4">
    <div class="alert-container">

        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>

    <div class="trips-intro-section">
        <h1>Your next adventure awaits!</h1>
        <p>Browse our currently available trips below. Find the perfect destination, check the details, and secure your spot for an unforgettable journey. Let's explore together!</p>
    </div>

    <div class="trip-wrapper">
        <div class="create-trip-button-container" th:if="${user != null and (user.get('role') == 'Manager' || user.get('role') == 'Manager | Guide' || user.get('role') == 'Manager | Guide | Traveler')}">
            <button class="btn btn-success mb-3" onclick="openAddTripModal()">Create trip</button>
        </div>

        <div th:each="trip : ${trips}" th:if="${!trip.canceled}"
             class="trip-card"
             th:classappend="${user != null and (user.get('role') == 'Manager' || user.get('role') == 'Manager | Guide' || user.get('role') == 'Manager | Guide | Traveler')} ? 'trip-card--manager' : ''">


            <div class="trip-column-image">
                <img th:src="@{${trip.picture}}" alt="Trip Image"/>
                <p th:text="${trip.destination}"></p>
                <button type="button" class="btn btn-primary enroll-button"
                        th:attr="data-tripid=${trip.id},
                                 data-destination=${trip.destination},
                                 data-spots=${trip.availableSpots}"
                        th:text="${trip.availableSpots > 0 ? 'Enroll' : 'Full'}"
                        th:disabled="${trip.availableSpots <= 0}">
                </button>
            </div>

            <div class="trip-details-wrapper">
                <div class="trip-info-grid">
                    <div class="trip-wrapper-details-item">
                        <h1>Departure location</h1>
                        <p th:text="${trip.departureLocation}"></p>
                    </div>
                    <div class="trip-wrapper-details-item">
                        <h1>Departure date</h1>
                        <p th:text="${trip.departureDate}"></p>
                    </div>
                    <div class="trip-wrapper-details-item">
                        <h1>Departure hour</h1>
                        <p th:text="${trip.departureHour + ' UTC'}"></p>
                    </div>
                    <div class="trip-wrapper-details-item">
                        <h1>Return date</h1>
                        <p th:text="${trip.returnDate}"></p>
                    </div>
                    <div class="trip-wrapper-details-item">
                        <h1>Remaining spots</h1>
                        <p th:text="${trip.availableSpots + ' spots'}"></p> </div>
                    <div class="trip-wrapper-details-item">
                        <h1>Enrollment fee</h1>
                        <p th:text="${trip.registrationFee + ' RON'}"></p>
                    </div>
                    <div class="trip-wrapper-details-item">
                        <h1>Hotel</h1>
                        <p th:text="${trip.hotelName}"></p>
                    </div>
                    <div class="trip-wrapper-details-item trip-guide-item">
                        <h1>Guide</h1>
                        <p>
                            <span th:if="${trip.guideId == null}">No guide assigned</span>
                            <span th:each="guide : ${guides}" th:if="${guide != null and guide['id'] == trip.guideId}"
                                  th:text="${guide['email']}"></span>
                        </p>
                    </div>
                </div>
                <div class="trip-wrapper-description">
                    <p th:text="${#strings.abbreviate(trip.description, 200)}"></p>
                </div>
            </div>

            <div class="trip-manager-buttons"
                 th:if="${user != null and (user.get('role') == 'Manager' || user.get('role') == 'Manager | Guide' || user.get('role') == 'Manager | Guide | Traveler')}">
                <button class="btn btn-info" th:attr="data-tripid=${trip.id}"
                        onclick="openViewTravelersModal(this)">View travelers</button>
                <button class="btn btn-warning" th:attr="data-tripid=${trip.id}"
                        onclick="openEditTripModal(this)">Edit trip</button>
                <button class="btn btn-danger" th:attr="data-tripid=${trip.id}"
                        onclick="openDeleteModal(this)">Cancel trip</button>
            </div>
        </div>

        <div class="pagination" th:if="${totalPages > 1}">
            <a th:if="${page > 0}" th:href="@{'/trips?page=' + ${page - 1}}">
                <button>&#8592;</button>
            </a>
            <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:if="${i != page}" th:href="@{'/trips?page=' + ${i}}">
                    <button th:text="${i + 1}"></button>
                </a>
                <span th:if="${i == page}" class="current-page" th:text="${i + 1}"></span>
            </span>
            <a th:if="${page + 1 < totalPages}" th:href="@{'/trips?page=' + ${page + 1}}">
                <button>&#8594;</button>
            </a>
        </div>

    </div>

    <div class="no-trips-container" th:if="${trips == null or #lists.isEmpty(trips)}">
        <p>No trips available at the moment.</p>
    </div>

</div>

<div th:replace="~{fragments/trip-modals :: viewTravelersModal}"></div>
<div th:replace="~{fragments/trip-modals :: addTripModal}"></div>
<div th:replace="~{fragments/trip-modals :: enrollModal}"></div>
<div th:replace="~{fragments/trip-modals :: editTripModal}"></div>
<div th:replace="~{fragments/trip-modals :: deleteTripModal}"></div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"></script>
<script th:src="@{/js/trip.js}"></script>
<script th:src="@{/js/header.js}"></script>

</body>
</html>